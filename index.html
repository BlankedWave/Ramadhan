<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelantan Islamic System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-white">
    <div class="container mx-auto p-6 text-center">
        <h1 class="text-3xl font-bold mb-4">Waktu Solat - Malaysia</h1>

        <label for="zoneSelect" class="block text-lg font-semibold">Pilih Zon:</label>
        <select id="zoneSelect" class="mt-2 p-2 border border-gray-300 rounded text-black" onchange="getPrayerTimes()">
            <option value="">Pilih Zon</option>
            <option value="KTN01">Kota Bharu, Bachok, Pasir Puteh, Tumpat</option>
            <option value="KTN02">Jeli, Gua Musang</option>
            <option value="SGR01">Shah Alam, Klang, Petaling</option>
            <option value="JHR01">Johor Bahru, Kota Tinggi</option>
        </select>

        <p id="hijriDate" class="text-lg mt-4"></p>
        <p id="gregorianDate" class="text-lg mb-4"></p>
        
        <div id="prayerTimes" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4"></div>
        
        <div class="bg-blue-600 text-white p-4 rounded-lg shadow-lg">
            <h2 class="text-lg font-semibold">Ayat Al-Quran</h2>
            <p id="quranVerse" class="italic"></p>
        </div>

        <button onclick="toggleDarkMode()" class="mt-6 bg-gray-700 text-white py-2 px-4 rounded">
            Toggle Dark Mode üåô
        </button>
    </div>

    <script>
        async function getPrayerTimes() {
            const zone = document.getElementById("zoneSelect").value;
            if (!zone) return;
            try {
                const response = await fetch(`https://www.e-solat.gov.my/index.php?r=esolatApi/TakwimSolat&period=week&zone=${zone}`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                console.log("Prayer Times API Response:", data);

                if (!data || !data.prayerTime || !Array.isArray(data.prayerTime)) {
                    throw new Error("Invalid data format received from API");
                }

                const times = data.prayerTime[0]; // Ambil hari pertama
                let output = '';

                const prayerNames = {
                    "imsak": "Imsak",
                    "fajr": "Subuh",
                    "syuruk": "Syuruk",
                    "dhuha": "Dhuha",
                    "dhuhr": "Zohor",
                    "asr": "Asar",
                    "maghrib": "Maghrib",
                    "isha": "Isyak"
                };

                Object.entries(prayerNames).forEach(([key, name]) => {
                    if (times[key]) {
                        output += `<div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                            <h3 class="font-semibold">${name}</h3>
                            <p>${times[key]}</p>
                        </div>`;
                    }
                });
                document.getElementById("prayerTimes").innerHTML = output;
            } catch (error) {
                console.error("Error fetching prayer times:", error);
                alert("Gagal mendapatkan waktu solat. Sila cuba lagi nanti.");
            }
        }

        async function getQuranVerse() {
            try {
                const response = await fetch('https://api.alquran.cloud/v1/ayah/random');
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                console.log("Quran Verse API Response:", data);
                
                if (!data || !data.data || typeof data.data !== 'object' || !data.data.text || !data.data.surah) {
                    throw new Error("Invalid data format received from API");
                }

                document.getElementById("quranVerse").innerText = `"${data.data.text}" - Surah ${data.data.surah.englishName}`;
            } catch (error) {
                console.error("Error fetching Quran verse:", error);
                document.getElementById("quranVerse").innerText = "Gagal mendapatkan ayat Al-Quran.";
            }
        }

        function displayDate() {
            const today = new Date();
            document.getElementById("gregorianDate").innerText = `üìÖ Tarikh Masihi: ${today.toDateString()}`;
            document.getElementById("hijriDate").innerText = `üè† Tarikh Hijri: ${Intl.DateTimeFormat('ar-SA-u-ca-islamic', {dateStyle: 'long'}).format(today)}`;
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
        }

        getQuranVerse();
        displayDate();
    </script>
</body>
</html>
