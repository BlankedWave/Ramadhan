<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelantan Islamic System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-white">
    <div class="container mx-auto p-6 text-center">
        <h1 class="text-3xl font-bold mb-4">Waktu Solat - Malaysia</h1>

        <label for="zoneSelect" class="block text-lg font-semibold">Pilih Zon:</label>
        <select id="zoneSelect" class="mt-2 p-2 border border-gray-300 rounded text-black" onchange="getPrayerTimes()">
            <option value="">Loading zones...</option>
        </select>

        <p id="hijriDate" class="text-lg mt-4"></p>
        <p id="gregorianDate" class="text-lg mb-4"></p>
        
        <div id="prayerTimes" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4"></div>
        
        <div class="bg-blue-600 text-white p-4 rounded-lg shadow-lg">
            <h2 class="text-lg font-semibold">Ayat Al-Quran</h2>
            <p id="quranVerse" class="italic"></p>
        </div>

        <button onclick="toggleDarkMode()" class="mt-6 bg-gray-700 text-white py-2 px-4 rounded">
            Toggle Dark Mode üåô
        </button>
    </div>

    <script>
        async function getZones() {
            try {
                const response = await fetch('https://api.waktusolat.app/zones');
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                console.log("Zones API Response:", data);

                // Check if the response contains the expected data structure
                if (!data || !Array.isArray(data)) {
                    throw new Error("Invalid data format received from API");
                }

                const select = document.getElementById("zoneSelect");
                select.innerHTML = '<option value="">Pilih Zon</option>';
                data.forEach(zone => {
                    if (zone.code && zone.name) {
                        let option = document.createElement("option");
                        option.value = zone.code;
                        option.text = `${zone.name} (${zone.code})`;
                        select.appendChild(option);
                    }
                });
            } catch (error) {
                console.error("Error fetching zones:", error);
                alert("Gagal mendapatkan senarai zon. Sila cuba lagi nanti.");
            }
        }

        async function getPrayerTimes() {
            const zone = document.getElementById("zoneSelect").value;
            if (!zone) return;

            try {
                const response = await fetch(`https://api.waktusolat.app/v2/solat/${zone}`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                console.log("Prayer Times API Response:", data);

                // Check if the response contains the expected data structure
                if (!data || typeof data !== 'object' || !data.times) {
                    throw new Error("Invalid data format received from API");
                }

                const times = data.times;
                let output = '';

                Object.entries(times).forEach(([key, value]) => {
                    if (typeof value === 'string') {
                        output += `<div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                            <h3 class="font-semibold">${key.toUpperCase()}</h3>
                            <p>${value}</p>
                        </div>`;
                    }
                });

                document.getElementById("prayerTimes").innerHTML = output;
            } catch (error) {
                console.error("Error fetching prayer times:", error);
                alert("Gagal mendapatkan waktu solat. Sila cuba lagi nanti.");
            }
        }

        async function getQuranVerse() {
            try {
                const response = await fetch('https://api.alquran.cloud/v1/ayah/random');
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                console.log("Quran Verse API Response:", data);

                // Check if the response contains the expected data structure
                if (!data || !data.data || typeof data.data !== 'object' || !data.data.text || !data.data.surah) {
                    throw new Error("Invalid data format received from API");
                }

                document.getElementById("quranVerse").innerText = `"${data.data.text}" - Surah ${data.data.surah.englishName}`;
            } catch (error) {
                console.error("Error fetching Quran verse:", error);
                document.getElementById("quranVerse").innerText = "Gagal mendapatkan ayat Al-Quran.";
            }
        }

        function displayDate() {
            const today = new Date();
            document.getElementById("gregorianDate").innerText = `üìÖ Tarikh Masihi: ${today.toDateString()}`;

            // Format Hijri date
            const hijriDate = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', { dateStyle: 'long' }).format(today);
            document.getElementById("hijriDate").innerText = `üè† Tarikh Hijri: ${hijriDate}`;
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
        }

        getZones();
        getQuranVerse();
        displayDate();
    </script>
</body>
</html>
